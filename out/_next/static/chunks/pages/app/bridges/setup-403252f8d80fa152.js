(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[176],{8573:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/bridges/setup",function(){return n(9495)}])},1755:function(e,t,n){"use strict";n.d(t,{Z:function(){return Common_Layout}});var i=n(5893),a=n(7294),r=n(1163),o=n(9008),s=n.n(o),l=n(3946),d=n(8849),c=n(5317),u=n(8298),p=n(2734),h=n(2293),g=n(5582),x=n(155),m=n(6886),y=n(9417),f=n(5861),j=n(7357);function ElevationScroll(e){let{children:t}=e,n=(0,u.Z)({disableHysteresis:!0,threshold:24});return(0,a.cloneElement)(t,{elevation:n?4:0})}var Common_Header=function(){let[e,t]=(0,a.useState)(!1);(0,a.useCallback)(()=>{t(!e)},[e]);let n=(0,p.Z)();return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(ElevationScroll,{children:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(h.Z,{color:"transparent",elevation:0,children:(0,i.jsx)(g.Z,{maxWidth:"xl",sx:{padding:0},children:(0,i.jsx)(x.Z,{sx:{minHeight:50,maxHeight:50,padding:0,flex:1,alignItems:"center",justifyContent:"space-between",display:"flex",flexWrap:"nowrap"},children:(0,i.jsx)(m.ZP,{item:!0,children:(0,i.jsx)(y.Z,{href:"https://system-bridge.timmo.dev",target:"_blank",children:(0,i.jsx)(f.Z,{component:"div",variant:"h4",sx:{textTransform:"none",userSelect:"none",color:n.palette.primary.contrastText},children:"System Bridge"})})})})})}),(0,i.jsx)(j.Z,{sx:{height:n.spacing(18)}})]})})})};let v=!1;var Common_Layout=function(e){let t=(0,r.useRouter)();return(0,a.useEffect)(()=>{if(t.isReady&&!v){var e,n,i,a;v=!0;let r=(null===(e=t.query)||void 0===e?void 0:e.apiKey)||"",o=(null===(n=t.query)||void 0===n?void 0:n.apiPort)||"9170",s=!1;if((null===(i=t.query)||void 0===i?void 0:i.apiKey)||(s=!0,r=window.prompt("Please enter your API key",r)),(null===(a=t.query)||void 0===a?void 0:a.apiPort)||(s=!0,o=window.prompt("Please enter your API port (default: 9170)",o)),s&&r&&o){let e=t.asPath.split("?")[0];t.replace({pathname:e.includes(".html")?e:"".concat(e,".html"),query:{...t.query,apiKey:r,apiPort:o}})}}},[t]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(s(),{children:[(0,i.jsx)("title",{children:e.title?"".concat(e.title," - System Bridge"):"System Bridge"}),(0,i.jsx)("link",{rel:"canonical",href:e.url}),(0,i.jsx)("meta",{name:"description",content:e.description?"".concat(e.description):e.title?"".concat(e.title," - System Bridge"):"System Bridge"}),(0,i.jsx)("meta",{name:"keywords",content:e.keywords?"".concat(e.keywords):"system-bridge, system, bridge, typescript"})]}),!e.noHeader&&(0,i.jsx)(Common_Header,{}),e.closeButton&&(0,i.jsx)(l.Z,{size:"small",sx:{position:"absolute",top:4,right:4,zIndex:1e3},onClick:()=>{window.location.href="http://close.window"},children:(0,i.jsx)(d.Icon,{id:"close",path:c.r5M,size:1})}),e.children]})}},9495:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return setup}});var i=n(5893),a=n(7294),r=n(1755),o=n(1163),s=n(2734),l=n(5582),d=n(6886),c=n(8456),u=n(5861),p=n(8462),h=n(9294),g=n(9953),x=n(6154),m=n(4583),y=n(8396),f=n(657),j=n(7645),v=n(6514),Z=n(699),k=n(1425),b=n(9417),Edit=function(e){let[t,n]=(0,a.useState)(e.bridgeEdit.bridge),[r,l]=(0,a.useState)({text:"",error:!1}),d=(0,o.useRouter)().query,handleTextChanged=e=>i=>{n({...t,[e]:i.target.value})};async function handleDelete(){let n=await x.Z.delete("http://".concat((d.apiHost,window.location.hostname),":").concat(d.apiPort||9170,"/api/remote/").concat(t.key),{headers:{"api-key":d.apiKey}});n&&n.status<400?e.handleClose():l({text:"Failed to delete bridge",error:!0})}async function handleSave(){let n=await handleTestBridge();if(n&&n.uuid){let i;let a={...t,key:n.uuid},r="http://".concat((d.apiHost,window.location.hostname),":").concat(d.apiPort||9170,"/api/remote");console.log("Save:",{url:r,bridgeData:a});try{(i=e.bridgeEdit.edit?await x.Z.put("".concat(r,"/").concat(t.key),a,{headers:{"api-key":d.apiKey}}):await x.Z.post(r,a,{headers:{"api-key":d.apiKey}}))&&i.status<400?e.handleClose():l({text:"Failed to save bridge",error:!0})}catch(e){console.error(e)}}}async function handleTestBridge(){if(l({text:"Testing bridge..",error:!1}),null==t?void 0:t.api_key)try{let e=await x.Z.get("http://".concat(t.host,":").concat(t.port,"/api/data/system"),{headers:{"api-key":t.api_key}});if(e&&e.status<400)return console.log("System:",e.data),l({text:"Successfully connected to bridge.",error:!1}),e.data;l({text:"Error testing bridge: ".concat(e.status," - ").concat(e.data),error:!0})}catch(e){console.error("Error:",e),l({text:"Error testing bridge: ".concat(e.message),error:!0})}return null}let c=(0,s.Z)(),p=(0,y.Z)(c.breakpoints.down("lg"));return(0,i.jsxs)(f.Z,{"aria-labelledby":"form-dialog-title",fullScreen:p,maxWidth:"md",open:!0,children:[(0,i.jsxs)(j.Z,{id:"form-dialog-title",children:[e.bridgeEdit.edit?"Edit":""," ",t.name]}),(0,i.jsxs)(v.Z,{children:[(0,i.jsx)(Z.Z,{autoFocus:!0,fullWidth:!0,id:"name",label:"Name",onChange:handleTextChanged("name"),type:"text",value:t.name||"",variant:"outlined",sx:{margin:c.spacing(1,0)}}),(0,i.jsx)(Z.Z,{fullWidth:!0,id:"host",label:"Host",onChange:handleTextChanged("host"),type:"text",value:t.host||"",variant:"outlined",sx:{margin:c.spacing(1,0)}}),(0,i.jsx)(Z.Z,{fullWidth:!0,id:"port",label:"Port",onChange:handleTextChanged("port"),type:"number",value:t.port||9170,variant:"outlined",sx:{margin:c.spacing(1,0)}}),(0,i.jsx)(Z.Z,{fullWidth:!0,id:"api_key",label:"API Key",onChange:handleTextChanged("api_key"),type:"text",value:t.api_key||"",variant:"outlined",sx:{margin:c.spacing(1,0)}})]}),(0,i.jsxs)(k.Z,{sx:{padding:c.spacing(0,2,1)},children:[(0,i.jsx)(b.Z,{disabled:void 0===t.key,onClick:handleDelete,color:"error",variant:"contained",sx:{margin:c.spacing(1,0)},children:"Delete"}),(0,i.jsx)(u.Z,{color:r.error?"error":"textPrimary",variant:"subtitle2",sx:{margin:c.spacing(0,1),flex:1,textAlign:"right"},children:r.text}),(0,i.jsx)(b.Z,{autoFocus:!0,onClick:function(){l({text:"",error:!1}),e.handleClose()},variant:"contained",children:"Cancel"}),(0,i.jsx)(b.Z,{onClick:handleSave,color:"primary",variant:"contained",children:"Save"})]})]})};let C={port:9170};var Setup=function(){let[e,t]=(0,a.useState)(),[n,r]=(0,a.useState)(),[y]=(0,m.r)(),[f,j]=(0,a.useState)(!1),v=(0,o.useRouter)().query,Z=(0,a.useCallback)(async()=>{console.log("Setup Bridges");let e=await x.Z.get("http://".concat((v.apiHost,window.location.hostname),":").concat(v.apiPort||9170,"/api/remote"),{headers:{"api-key":v.apiKey}});e&&e.status<400&&r(e.data.data)},[v.apiHost,v.apiPort,v.apiKey]);function handleItemClick(e,n){t({bridge:e,edit:n})}async function handleBridgeEditClosed(){j(!0),await Z(),t(void 0)}(0,a.useEffect)(()=>{!f&&v&&v.apiKey&&(j(!0),Z())},[f,Z,v]);let k=(0,s.Z)();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.Z,{maxWidth:"lg",children:y||n?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.Z,{component:"h2",variant:"h3",sx:{margin:k.spacing(2,1.5,6)},children:"Bridges"}),n?(0,i.jsx)(p.Z,{children:n.map(e=>(0,i.jsx)(h.ZP,{button:!0,onClick:()=>handleItemClick(e,!0),children:(0,i.jsx)(g.Z,{primary:"".concat(e.name," ").concat(e.api_key?"":"(Not Configured)"),secondary:"".concat(e.host,":").concat(e.port),color:e.api_key?"primary":"error"})},e.key))}):"",(0,i.jsx)(h.ZP,{button:!0,onClick:()=>handleItemClick(C,!1),children:(0,i.jsx)(g.Z,{primary:"Add Bridge",secondary:"Add a new bridge",color:"primary"})})]}):(0,i.jsx)(d.ZP,{container:!0,direction:"row",justifyContent:"center",sx:{margin:k.spacing(10,0,8)},children:(0,i.jsx)(c.Z,{})})}),e?(0,i.jsx)(Edit,{bridgeEdit:e,handleClose:handleBridgeEditClosed}):""]})},setup=function(){return(0,i.jsx)(r.Z,{title:"Bridges",url:"https://system-bridge.timmo.dev",description:"Frontend for System Bridge",noHeader:!0,children:(0,i.jsx)(Setup,{})})}}},function(e){e.O(0,[702,920,67,8,699,154,767,774,888,179],function(){return e(e.s=8573)}),_N_E=e.O()}]);