"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[234],{1755:function(e,t,n){n.d(t,{Z:function(){return Common_Layout}});var o=n(5893),s=n(7294),i=n(1163),r=n(9008),a=n.n(r),l=n(3946),c=n(8849),u=n(5317),d=n(8298),p=n(2734),m=n(2293),h=n(5582),y=n(155),x=n(6886),v=n(9417),b=n(5861),g=n(7357);function ElevationScroll(e){let{children:t}=e,n=(0,d.Z)({disableHysteresis:!0,threshold:24});return(0,s.cloneElement)(t,{elevation:n?4:0})}var Common_Header=function(){let[e,t]=(0,s.useState)(!1);(0,s.useCallback)(()=>{t(!e)},[e]);let n=(0,p.Z)();return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(ElevationScroll,{children:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(m.Z,{color:"transparent",elevation:0,children:(0,o.jsx)(h.Z,{maxWidth:"xl",sx:{padding:0},children:(0,o.jsx)(y.Z,{sx:{minHeight:50,maxHeight:50,padding:0,flex:1,alignItems:"center",justifyContent:"space-between",display:"flex",flexWrap:"nowrap"},children:(0,o.jsx)(x.ZP,{item:!0,children:(0,o.jsx)(v.Z,{href:"https://system-bridge.timmo.dev",target:"_blank",children:(0,o.jsx)(b.Z,{component:"div",variant:"h4",sx:{textTransform:"none",userSelect:"none",color:n.palette.primary.contrastText},children:"System Bridge"})})})})})}),(0,o.jsx)(g.Z,{sx:{height:n.spacing(18)}})]})})})};let k=!1;var Common_Layout=function(e){let t=(0,i.useRouter)();return(0,s.useEffect)(()=>{if(t.isReady&&!k){var e,n,o,s;k=!0;let i=(null===(e=t.query)||void 0===e?void 0:e.apiKey)||"",r=(null===(n=t.query)||void 0===n?void 0:n.apiPort)||"9170",a=!1;if((null===(o=t.query)||void 0===o?void 0:o.apiKey)||(a=!0,i=window.prompt("Please enter your API key",i)),(null===(s=t.query)||void 0===s?void 0:s.apiPort)||(a=!0,r=window.prompt("Please enter your API port (default: 9170)",r)),a&&i&&r){let e=t.asPath.split("?")[0];t.replace({pathname:e.includes(".html")?e:"".concat(e,".html"),query:{...t.query,apiKey:i,apiPort:r}})}}},[t]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(a(),{children:[(0,o.jsx)("title",{children:e.title?"".concat(e.title," - System Bridge"):"System Bridge"}),(0,o.jsx)("link",{rel:"canonical",href:e.url}),(0,o.jsx)("meta",{name:"description",content:e.description?"".concat(e.description):e.title?"".concat(e.title," - System Bridge"):"System Bridge"}),(0,o.jsx)("meta",{name:"keywords",content:e.keywords?"".concat(e.keywords):"system-bridge, system, bridge, typescript"})]}),!e.noHeader&&(0,o.jsx)(Common_Header,{}),e.closeButton&&(0,o.jsx)(l.Z,{size:"small",sx:{position:"absolute",top:4,right:4,zIndex:1e3},onClick:()=>{window.location.href="http://close.window"},children:(0,o.jsx)(c.Icon,{id:"close",path:u.r5M,size:1})}),e.children]})}},2301:function(e,t,n){n.d(t,{D:function(){return usePrevious},X:function(){return handleCopyToClipboard}});var o=n(7294);function handleCopyToClipboard(e){navigator.permissions.query({name:"clipboard-write"}).then(t=>{("granted"===t.state||"prompt"===t.state)&&navigator.clipboard.writeText(e)})}function usePrevious(e){let t=(0,o.useRef)();return(0,o.useEffect)(()=>{t.current=e}),t.current}},4103:function(e,t,n){n.d(t,{C:function(){return WebSocketConnection}});let WebSocketConnection=class WebSocketConnection{close(){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&this.websocket.close()}async connect(){let e=new WebSocket("ws://".concat(window.location.hostname||"localhost",":").concat(this.port,"/api/websocket"));return await new Promise(t=>{e.onopen=()=>t()}),e.onmessage=e=>{if("string"==typeof e.data){let t=JSON.parse(e.data);t&&this.onEvent&&this.onEvent(t)}},e}isConnected(){var e;return(null===(e=this.websocket)||void 0===e?void 0:e.readyState)===WebSocket.OPEN}getData(e){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Get data:",e),this.websocket.send(JSON.stringify({api_key:this.apiKey,event:"GET_DATA",modules:e})))}getSettings(){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Get settings"),this.websocket.send(JSON.stringify({api_key:this.apiKey,event:"GET_SETTINGS"})))}registerDataListener(e){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Register data listener:",e),this.websocket.send(JSON.stringify({api_key:this.apiKey,event:"REGISTER_DATA_LISTENER",modules:e})))}sendPlayerStatus(e){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&this.websocket.send(JSON.stringify({api_key:this.apiKey,event:"MEDIA_STATUS",status:e}))}updateSetting(e,t){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Update setting:",{key:e,value:t}),this.websocket.send(JSON.stringify({api_key:this.apiKey,event:"UPDATE_SETTING",setting:e,value:t})))}constructor(e,t,n){this.port=e||9170,this.apiKey=t,(async()=>{this.websocket=await this.connect(),n&&this.websocket&&this.websocket.readyState===this.websocket.OPEN&&n()})()}}},3298:function(e,t,n){let o;n.d(t,{Z:function(){return Player}});var s=n(5893),i=n(7294),r=n(9974),a=n(361),l=n.n(a),c=n(8446),u=n.n(c),d=n(4764),p=n(2301),m=n(4103),h=n(2734),y=n(6886),x=n(7357),v=n(2022),b=n(6628),g=n(5861),k=n(3946),f=n(5929),w=n(8849),S=n(5317),P=n(381),j=n.n(P),E=n(6310),Audio=function(){let[e,t]=(0,d.nn)(),[n,o]=(0,i.useState)(!1),[r,a]=(0,d.XI)(),l=(0,i.useRef)(null),{duration:c,playing:u,muted:p,loaded:m,position:P,volume:C}=(0,i.useMemo)(()=>e,[e]),Z=(0,i.useMemo)(()=>"".concat((100*C).toFixed(0),"%"),[C]),_=(0,i.useMemo)(()=>{let e=j().duration(P,"seconds");return"".concat(e.minutes().toString().padStart(2,"0"),":").concat(e.seconds().toString().padStart(2,"0"))},[P]),I=(0,i.useMemo)(()=>{let e=j().duration(c,"seconds");return"".concat(e.minutes().toString().padStart(2,"0"),":").concat(e.seconds().toString().padStart(2,"0"))},[c]),{artist:A,album:M,cover:N,source:T,title:D}=(0,i.useMemo)(()=>e.source,[e]),O=(0,i.useCallback)(n=>{t({...e,loaded:n})},[e,t]),L=(0,i.useCallback)(n=>{t({...e,playing:n})},[e,t]),U=(0,i.useCallback)(()=>{L(!u)},[u,L]),K=(0,i.useCallback)(n=>{t({...e,muted:n})},[e,t]),W=(0,i.useCallback)(()=>{K(!p)},[p,K]),R=(0,i.useCallback)((n,o)=>{let s="down"===o?C-n:"up"===o?C+n:n;s>1&&(s=1),s<0&&(s=0),t({...e,volume:s}),p&&K(!1)},[p,C,e,t,K]),q=(0,i.useCallback)(n=>{t({...e,duration:n})},[e,t]),z=(0,i.useCallback)(n=>{c&&n>c&&(n=c),n<0&&(n=0),t({...e,position:n})},[e,c,t]),H=(0,i.useCallback)(e=>{var t;null===(t=l.current)||void 0===t||t.seekTo(e,"seconds"),o(!1),u||L(!0)},[u,L]);function handleScrubStart(){L(!1),o(!0)}function handleScrubEnd(){P&&H(P)}(0,i.useEffect)(()=>{m||O(!0)},[m,O,L]);let F=(0,h.Z)();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(E.Z,{ref:l,height:"0px",width:"0px",muted:p,playing:u,stopOnUnmount:!0,url:T,volume:C,onDuration:e=>{q(e)},onPause:()=>{L(!1)},onPlay:()=>{L(!0)},onStart:()=>{L(!0)},onProgress:e=>{let{playedSeconds:t}=e;n||z(t)}}),(0,s.jsxs)(y.ZP,{container:!0,direction:"row",alignItems:"center",justifyItems:"center",wrap:"nowrap",sx:{height:140,width:540,overflow:"hidden"},children:[(0,s.jsx)(y.ZP,{item:!0,sx:{width:140,margin:F.spacing(0,1,0,0)},children:(0,s.jsx)(x.Z,{ref:r,children:(0,s.jsxs)(v.Z,{"aria-label":u?"Pause":"Play",onClick:U,children:[(0,s.jsx)("img",{alt:"".concat(A," - ").concat(M),src:N||"https://raw.githubusercontent.com/timmo001/system-bridge/master/resources/system-bridge-dimmed.svg",width:140}),(0,s.jsx)(b.Z,{in:!!a,timeout:{enter:200,exit:400},children:(0,s.jsx)(x.Z,{sx:{position:"absolute",display:"flex",height:"100%",width:"100%",zIndex:100},children:(0,s.jsx)(w.Icon,{id:u?"pause":"play",path:u?S.Wa1:S._86,size:6,style:{position:"relative",margin:"auto"}})})})]})})}),(0,s.jsx)(y.ZP,{item:!0,xs:!0,children:(0,s.jsxs)(y.ZP,{container:!0,direction:"column",alignItems:"flex-start",justifyItems:"space-around",children:[(0,s.jsx)(y.ZP,{item:!0,children:(0,s.jsxs)(g.Z,{color:"textPrimary",component:"span",variant:"subtitle1",noWrap:!0,children:[A," - ",D]})}),(0,s.jsx)(y.ZP,{item:!0,children:(0,s.jsx)(g.Z,{color:"textSecondary",component:"span",variant:"subtitle2",noWrap:!0,children:M})}),(0,s.jsxs)(y.ZP,{item:!0,container:!0,alignContent:"center",children:[(0,s.jsx)(y.ZP,{item:!0,xs:4}),(0,s.jsx)(y.ZP,{sx:{margin:F.spacing(0,1,0,0)},item:!0,children:(0,s.jsx)(k.Z,{size:"small",onClick:W,children:p?(0,s.jsx)(w.Icon,{id:"mute",path:S.PLS,size:1.25}):(0,s.jsx)(w.Icon,{id:"unmute",path:S.dw,size:1.25})})}),(0,s.jsx)(y.ZP,{sx:{margin:F.spacing(.6,2,0,0)},item:!0,xs:!0,children:(0,s.jsx)(f.ZP,{min:0,max:1,step:.01,value:C,onChange:(e,t)=>{"number"==typeof t&&R(t)}})}),(0,s.jsx)(y.ZP,{sx:{margin:F.spacing(.9,C>=1?1:2,0,0)},item:!0,children:(0,s.jsx)(g.Z,{component:"span",variant:"body2",children:Z})})]}),(0,s.jsxs)(y.ZP,{container:!0,children:[(0,s.jsx)(y.ZP,{sx:{margin:F.spacing(.25,2,0,0)},item:!0,children:(0,s.jsx)(g.Z,{component:"span",variant:"body2",children:_})}),(0,s.jsx)(y.ZP,{sx:{margin:F.spacing(0,2,0,0)},item:!0,xs:!0,children:(0,s.jsx)(f.ZP,{min:0,max:c,step:.1,value:P,valueLabelDisplay:"off",onMouseDown:handleScrubStart,onKeyDown:handleScrubStart,onChange:function(e,t){z(t)},onMouseUp:handleScrubEnd,onKeyUp:handleScrubEnd})}),(0,s.jsx)(y.ZP,{sx:{margin:F.spacing(.25,1,0,0)},item:!0,children:(0,s.jsx)(g.Z,{component:"span",variant:"body2",children:I})})]})]})})]})]})},Video=function(){let[e,t]=(0,d.nn)(),{autoplay:n,duration:o,playing:r,muted:a,loaded:l,volume:c}=(0,i.useMemo)(()=>e,[e]),{source:u}=(0,i.useMemo)(()=>e.source,[e]),p=(0,i.useCallback)(n=>{t({...e,loaded:n})},[e,t]),m=(0,i.useCallback)(n=>{console.log("Set playing:",n),t({...e,playing:n})},[e,t]),h=(0,i.useCallback)(n=>{t({...e,muted:n})},[e,t]);(0,i.useCallback)((n,o)=>{let s="down"===o?c-n:"up"===o?c+n:n;s>1&&(s=1),s<0&&(s=0),t({...e,volume:s}),a&&h(!1)},[a,c,e,t,h]);let y=(0,i.useCallback)(n=>t({...e,duration:n}),[e,t]),x=(0,i.useCallback)(n=>{o&&n>o&&(n=o),n<0&&(n=0),t({...e,position:n})},[e,o,t]);return(0,i.useEffect)(()=>{l||p(!0)},[l,p]),(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(E.Z,{autoPlay:n,controls:!0,height:"270px",width:"480px",playsinline:!0,muted:a,playing:r,url:u,volume:c,style:{position:"absolute",top:"0",left:"0",overflow:"hidden"},onReady:()=>{console.log("Autoplay:",n),m(n||!1)},onDuration:e=>y(e),onPause:()=>m(!1),onPlay:()=>m(!0),onStart:()=>m(!0),onProgress:e=>{let{playedSeconds:t}=e;return x(t)}})})},Player=function(e){let{playerType:t}=e,[n,a]=(0,i.useState)(!1),[c,h]=(0,d.nn)(),y=(0,p.D)(c),x=(0,r.useRouter)(),v=x.query,b=(0,i.useCallback)(e=>{switch(console.log("Event:",e),e.type){case"MEDIA_PAUSE":h({...c,playing:!1});break;case"MEDIA_PLAY":h({...c,playing:!0});break;case"MEDIA_VOLUME_DOWN":e.volume&&h({...c,volume:c.volume-e.volume});break;case"MEDIA_VOLUME_UP":e.volume&&h({...c,volume:c.volume+e.volume});break;case"MEDIA_VOLUME_SET":e.volume&&h({...c,volume:e.volume});break;case"MEDIA_VOLUME_SET":e.position&&h({...c,position:e.position})}},[c,h]),g=(0,i.useCallback)((e,t)=>{console.log("Setup WebSocketConnection"),(o=new m.C(e,t,async()=>{console.log("Connected to WebSocket")})).onEvent=b},[b]);(0,i.useEffect)(()=>{!n&&v&&v.apiKey&&(a(!0),g(Number(v.apiPort)||9170,String(v.apiKey)))},[n,g,v]),(0,i.useEffect)(()=>{if(!c&&x.isReady){var e,n;let o=Number(v.volume);switch(t){default:break;case"audio":h({autoplay:(null===(e=v.autoplay)||void 0===e?void 0:e.toLowerCase())==="true",muted:!1,playing:!1,loaded:!1,position:0,duration:1,source:{type:"audio",source:v.url,album:v.album||"Unknown Album",artist:v.artist||"Unknown Aritst",cover:v.cover,title:v.title||"Unknown Title",volumeInitial:(o>0?o:40)/100},volume:(o>0?o:40)/100});break;case"video":h({autoplay:(null===(n=v.autoplay)||void 0===n?void 0:n.toLowerCase())==="true",muted:!1,playing:!1,loaded:!1,position:0,duration:1,source:{type:"video",source:String(v.url),volumeInitial:(o>0?o:40)/100},volume:(o>0?o:40)/100})}}},[c,h,t,x,v]),(0,i.useEffect)(()=>{if(c){let e;y&&"audio"===(e=l()(y)).source.type&&delete e.source.cover;let t=l()(c);if("audio"===t.source.type&&delete t.source.cover,!u()(t,e)){if(console.log("Player update\n\npreviousStatus:",e,"\nnewStatus:",t),!t.loaded||!o)return;if(!o.isConnected()){a(!1),console.warn("WebSocket not connected");return}o.sendPlayerStatus(t)}}},[c,y]);let k=(0,i.useMemo)(()=>{if(c)return c.source.type},[c]);return(0,s.jsx)(s.Fragment,{children:"audio"===k?(0,s.jsx)(Audio,{}):"video"===k?(0,s.jsx)(Video,{}):""})}},4764:function(e,t,n){n.d(t,{I0:function(){return PlayerProvider},XI:function(){return useHover},nn:function(){return usePlayer}});var o=n(5893),s=n(7294);let i=(0,s.createContext)(void 0),r=(0,s.createContext)(null),PlayerProvider=e=>{let{children:t}=e,[n,a]=(0,s.useState)();return(0,o.jsx)(r.Provider,{value:a,children:(0,o.jsx)(i.Provider,{value:n,children:t})})},usePlayer=()=>{let e=(0,s.useContext)(i),t=(0,s.useContext)(r);if(null===t)throw Error();return[e,t]};function useHover(){let[e,t]=s.useState(!1),n=s.useCallback(()=>t(!0),[]),o=s.useCallback(()=>t(!1),[]),i=s.useRef(),r=s.useCallback(e=>{i.current&&(i.current.removeEventListener("mouseover",n),i.current.removeEventListener("mouseout",o)),i.current=e,i.current&&(i.current.addEventListener("mouseover",n),i.current.addEventListener("mouseout",o))},[n,o]);return[r,e]}}}]);